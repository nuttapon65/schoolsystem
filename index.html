<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÅ‡∏•‡∏∞‡πÅ‡∏ö‡∏ö‡∏™‡∏≥‡∏£‡∏ß‡∏à - ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏≠‡∏ô‡∏∏‡∏ö‡∏≤‡∏•‡πÄ‡∏•‡∏¢</title>
  
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
  <style>
    body { 
        font-family: 'Sarabun', sans-serif; 
        background-color: #f0f2f5; 
        padding-top: 20px; 
        padding-bottom: 60px; 
    }
    .main-container {
        max-width: 600px;
        margin: 0 auto;
    }
    .form-section { 
        background: white; 
        padding: 25px; 
        border-radius: 15px; 
        margin-bottom: 20px; 
        box-shadow: 0 2px 10px rgba(0,0,0,0.05); 
    }
    h2.school-name {
        color: #0d6efd;
        font-weight: 700;
        margin-bottom: 5px;
    }
    h5 { 
        color: #495057; 
        border-left: 5px solid #0d6efd; 
        padding-left: 10px; 
        margin-bottom: 20px; 
        font-weight: 600; 
    }
    .btn-search { 
        background-color: #ffc107; 
        color: #000; 
        border: none; 
    }
    .btn-search:hover { background-color: #ffca2c; }
    
    /* Rating Styles */
    .rating-group {
        display: flex;
        justify-content: space-between;
        gap: 5px;
    }
    .rating-label {
        width: 45px;
        height: 45px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        cursor: pointer;
        border: 2px solid #dee2e6;
        transition: all 0.2s;
    }
    .btn-check:checked + .rating-label {
        background-color: #0d6efd;
        color: white;
        border-color: #0d6efd;
        transform: scale(1.1);
        box-shadow: 0 4px 6px rgba(13, 110, 253, 0.3);
    }
    
    /* Scrollbar Modal */
    .result-list { max-height: 250px; overflow-y: auto; }
  </style>
  
  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600;700&display=swap" rel="stylesheet">
</head>
<body>

  <div class="container main-container">
    
    <div class="text-center mb-4">
      <h2 class="school-name">‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏≠‡∏ô‡∏∏‡∏ö‡∏≤‡∏•‡πÄ‡∏•‡∏¢</h2>
      <h5 style="border:none; padding:0; color: #6c757d;">‡πÅ‡∏ö‡∏ö‡∏™‡∏≥‡∏£‡∏ß‡∏à‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏∂‡∏á‡∏û‡∏≠‡πÉ‡∏à‡πÅ‡∏•‡∏∞<br>‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö-‡∏™‡πà‡∏á</h5>
    </div>
    
    <form id="registerForm" onsubmit="submitForm(event)">
      
      <div class="form-section">
        <h5>1. ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</h5>
        <input type="hidden" id="line_user_id" name="line_user_id" value="">
        
        <div class="mb-3">
          <label class="form-label fw-bold">‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô (Key ‡∏´‡∏•‡∏±‡∏Å)</label>
          <div class="input-group">
            <input type="text" class="form-control" id="nationalId" name="nationalId" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç 13 ‡∏´‡∏•‡∏±‡∏Å" required>
            <button class="btn btn-search" type="button" onclick="openSearchModal()">
              üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠
            </button>
          </div>
          <div class="form-text text-danger">*‡∏´‡∏≤‡∏Å‡∏à‡∏≥‡πÄ‡∏•‡∏Ç‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ ‡πÉ‡∏´‡πâ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏à‡∏≤‡∏Å‡∏ä‡∏∑‡πà‡∏≠</div>
        </div>

        <div class="mb-3">
          <label class="form-label">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</label>
          <input type="text" class="form-control bg-light" id="studentName" name="studentname" readonly required>
        </div>
        
        <div class="row">
            <div class="col-6 mb-3">
                <label class="form-label">‡∏ä‡∏±‡πâ‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô/‡∏´‡πâ‡∏≠‡∏á</label>
                <input type="text" class="form-control" name="room" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏õ.1/2" required>
            </div>
            <div class="col-6 mb-3">
                <label class="form-label">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á</label>
                <input type="text" class="form-control" name="parentname" required>
            </div>
        </div>

        <div class="row">
          <div class="col-6 mb-3">
            <label class="form-label">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå</label>
            <select class="form-select" name="relationship">
              <option value="‡∏ö‡∏¥‡∏î‡∏≤">‡∏ö‡∏¥‡∏î‡∏≤</option>
              <option value="‡∏°‡∏≤‡∏£‡∏î‡∏≤">‡∏°‡∏≤‡∏£‡∏î‡∏≤</option>
              <option value="‡∏ç‡∏≤‡∏ï‡∏¥">‡∏ç‡∏≤‡∏ï‡∏¥</option>
              <option value="‡∏≠‡∏∑‡πà‡∏ô‡πÜ">‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
            </select>
          </div>
          <div class="col-6 mb-3">
            <label class="form-label">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label>
            <input type="tel" class="form-control" name="phone" placeholder="08xxxxxxxx" required>
          </div>
        </div>
        
        <div class="mb-3">
          <label class="form-label">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</label>
          <textarea class="form-control" name="address" rows="2"></textarea>
        </div>
        
        <div class="mb-3">
          <label class="form-label fw-bold text-primary">‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏ï‡∏≠‡∏ô‡πÄ‡∏¢‡πá‡∏ô</label>
          <select class="form-select border-primary" name="special">
            <option value="No">‡πÑ‡∏°‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏ô (‡∏Å‡∏•‡∏±‡∏ö‡∏£‡∏≠‡∏ö‡∏õ‡∏Å‡∏ï‡∏¥ 15.30 ‡∏ô.)</option>
            <option value="Yes">‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏© (‡∏Å‡∏•‡∏±‡∏ö‡∏£‡∏≠‡∏ö‡πÄ‡∏¢‡πá‡∏ô 16.30 ‡∏ô.)</option>
          </select>
        </div>
      </div>

      <div class="form-section">
        <h5>2. ‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á & ‡πÅ‡∏ö‡∏ö‡∏™‡∏≥‡∏£‡∏ß‡∏à‡∏à‡∏£‡∏≤‡∏à‡∏£</h5>
        
        <div class="mb-3">
          <label class="form-label">‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡πÇ‡∏î‡∏¢‡∏û‡∏≤‡∏´‡∏ô‡∏∞‡πÉ‡∏î</label>
          <select class="form-select" name="transport">
            <option value="‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß">‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</option>
            <option value="‡∏£‡∏ñ‡∏à‡∏±‡∏Å‡∏£‡∏¢‡∏≤‡∏ô‡∏¢‡∏ô‡∏ï‡πå">‡∏£‡∏ñ‡∏à‡∏±‡∏Å‡∏£‡∏¢‡∏≤‡∏ô‡∏¢‡∏ô‡∏ï‡πå</option>
            <option value="‡∏£‡∏ñ‡∏£‡∏±‡∏ö‡∏™‡πà‡∏á‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô">‡∏£‡∏ñ‡∏£‡∏±‡∏ö‡∏™‡πà‡∏á‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</option>
            <option value="‡πÄ‡∏î‡∏¥‡∏ô‡πÄ‡∏ó‡πâ‡∏≤">‡πÄ‡∏î‡∏¥‡∏ô‡πÄ‡∏ó‡πâ‡∏≤</option>
          </select>
        </div>

        <div class="row">
          <div class="col-6 mb-3">
            <label class="form-label">‡∏õ‡∏£‡∏∞‡∏ï‡∏π‡πÄ‡∏Ç‡πâ‡∏≤</label>
            <select class="form-select" name="gate_in">
              <option value="1">‡∏õ‡∏£‡∏∞‡∏ï‡∏π 1 (‡∏´‡∏ô‡πâ‡∏≤)</option>
              <option value="2">‡∏õ‡∏£‡∏∞‡∏ï‡∏π 2 (‡∏´‡∏•‡∏±‡∏á)</option>
            </select>
          </div>
          <div class="col-6 mb-3">
            <label class="form-label">‡∏õ‡∏£‡∏∞‡∏ï‡∏π‡∏≠‡∏≠‡∏Å</label>
            <select class="form-select" name="gate_out">
              <option value="1">‡∏õ‡∏£‡∏∞‡∏ï‡∏π 1 (‡∏´‡∏ô‡πâ‡∏≤)</option>
              <option value="2">‡∏õ‡∏£‡∏∞‡∏ï‡∏π 2 (‡∏´‡∏•‡∏±‡∏á)</option>
            </select>
          </div>
        </div>
        
        <div class="row">
            <div class="col-6 mb-3">
              <label class="form-label small text-muted">‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡πà‡∏á (‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì)</label>
              <input type="time" class="form-control" name="time_in">
            </div>
            <div class="col-6 mb-3">
              <label class="form-label small text-muted">‡πÄ‡∏ß‡∏•‡∏≤‡∏£‡∏±‡∏ö (‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì)</label>
              <input type="time" class="form-control" name="time_out">
            </div>
        </div>

        <hr class="my-4">
        
        <div class="mb-4 text-center">
          <label class="form-label fw-bold mb-3">‡∏ó‡πà‡∏≤‡∏ô‡∏û‡∏∂‡∏á‡∏û‡∏≠‡πÉ‡∏à‡∏ï‡πà‡∏≠‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏£‡∏≤‡∏à‡∏£‡∏£‡∏∞‡∏î‡∏±‡∏ö‡πÉ‡∏î?</label>
          <div class="rating-group px-3">
             <div>
                 <input type="radio" class="btn-check" name="satisfaction" id="rate1" value="1">
                 <label class="rating-label" for="rate1">1</label>
                 <span class="d-block small text-muted mt-1">‡∏ô‡πâ‡∏≠‡∏¢</span>
             </div>
             <div>
                 <input type="radio" class="btn-check" name="satisfaction" id="rate2" value="2">
                 <label class="rating-label" for="rate2">2</label>
             </div>
             <div>
                 <input type="radio" class="btn-check" name="satisfaction" id="rate3" value="3">
                 <label class="rating-label" for="rate3">3</label>
             </div>
             <div>
                 <input type="radio" class="btn-check" name="satisfaction" id="rate4" value="4">
                 <label class="rating-label" for="rate4">4</label>
             </div>
             <div>
                 <input type="radio" class="btn-check" name="satisfaction" id="rate5" value="5" checked>
                 <label class="rating-label" for="rate5">5</label>
                 <span class="d-block small text-muted mt-1">‡∏°‡∏≤‡∏Å</span>
             </div>
          </div>
        </div>

        <div class="mb-3">
          <label class="form-label">‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</label>
          <textarea class="form-control" name="suggestion" rows="3" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á..."></textarea>
        </div>
      </div>

      <button type="submit" id="btnSubmit" class="btn btn-primary w-100 btn-lg shadow mb-5 py-3 rounded-pill fw-bold">
        ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô
      </button>
    </form>
  </div>

  <div class="modal fade" id="searchModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header bg-primary text-white">
          <h5 class="modal-title mb-0" style="color:white; border:none; padding:0;">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body bg-light">
          <div class="input-group mb-3">
            <input type="text" id="modalSearchInput" class="form-control" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô..." onkeypress="if(event.key === 'Enter') executeSearch()">
            <button class="btn btn-primary" type="button" onclick="executeSearch()">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button>
          </div>
          
          <div id="modalResultList" class="result-list list-group">
            <div class="text-center text-muted mt-3">‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    // --- ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Configuration ---
    // *** ‡∏≠‡∏¢‡πà‡∏≤‡∏•‡∏∑‡∏°‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Ñ‡πà‡∏≤‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ ***
    const LIFF_ID = "2008830546-kUtMFdic"; 
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxn4THGLjeO7pVcejmAb86H8wJpCa-ftm_m_2RHkomFtS91k5Durt78b3WtvtGTxRfT/exec"; 

    // --- ‡∏™‡πà‡∏ß‡∏ô‡∏Ç‡∏≠‡∏á LIFF ‡πÅ‡∏•‡∏∞ Form ---
    window.onload = async function() {
      await initializeLiff();
    };

    async function initializeLiff() {
      try {
        await liff.init({ liffId: LIFF_ID });
        if (liff.isLoggedIn()) {
          const profile = await liff.getProfile();
          document.getElementById('line_user_id').value = profile.userId;
        } else {
          // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ô LINE ‡∏à‡∏∞ Auto Login ‡πÅ‡∏ï‡πà‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡∏¥‡∏î Browser ‡∏ô‡∏≠‡∏Å ‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏±‡πà‡∏á Login
          if (liff.isInClient()) {
             // Do nothing specific
          } else {
             liff.login();
          }
        }
      } catch (err) {
        console.error('LIFF Init failed', err);
      }
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡πà‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏° (Submit)
    function submitForm(e) {
      e.preventDefault();
      
      const btn = document.getElementById('btnSubmit');
      btn.disabled = true;
      btn.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...';

      const form = document.getElementById('registerForm');
      const formData = new FormData(form);
      
      // ‡πÅ‡∏õ‡∏•‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏õ‡πá‡∏ô URL Parameters
      const data = new URLSearchParams();
      for (const pair of formData) {
          data.append(pair[0], pair[1]);
      }

      fetch(SCRIPT_URL, {
        method: 'POST',
        body: data
      })
      .then(response => {
        Swal.fire({
          icon: 'success',
          title: '‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!',
          text: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞‡πÅ‡∏ö‡∏ö‡∏™‡∏≥‡∏£‡∏ß‡∏à‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß',
          confirmButtonText: '‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á'
        }).then(() => {
          if(liff.isInClient()) {
             liff.closeWindow();
          } else {
             location.reload(); 
          }
        });
      })
      .catch(error => {
        console.error('Error:', error);
        Swal.fire({
          icon: 'error',
          title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
          text: '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà',
        });
        btn.disabled = false;
        btn.innerText = "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô";
      });
    }

    // --- ‡∏™‡πà‡∏ß‡∏ô‡∏Ç‡∏≠‡∏á Modal Search ---
    let searchModal;

    function openSearchModal() {
      searchModal = new bootstrap.Modal(document.getElementById('searchModal'));
      searchModal.show();
      document.getElementById('modalSearchInput').value = '';
      document.getElementById('modalResultList').innerHTML = '<div class="text-center text-muted mt-3">‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</div>';
      setTimeout(() => document.getElementById('modalSearchInput').focus(), 500);
    }

    function executeSearch() {
      const keyword = document.getElementById('modalSearchInput').value.trim();
      const listDiv = document.getElementById('modalResultList');

      if (!keyword) return;

      listDiv.innerHTML = '<div class="text-center text-primary mt-3"><span class="spinner-border spinner-border-sm"></span> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤...</div>';

      // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô searchStudents ‡πÉ‡∏ô Google Apps Script (code.gs)
      google.script.run.withSuccessHandler((results) => {
        listDiv.innerHTML = '';

        if (!results || results.length === 0) {
          listDiv.innerHTML = '<div class="text-center text-danger mt-3">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠</div>';
          return;
        }

        results.forEach(student => {
          const item = document.createElement('a');
          item.href = "#";
          item.className = "list-group-item list-group-item-action d-flex justify-content-between align-items-center";
          
          // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠
          item.innerHTML = `
            <div>
              <div class="fw-bold">${student.name}</div>
              <small class="text-muted">ID: ${maskId(student.id)}</small>
            </div>
            <span class="badge bg-primary rounded-pill">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</span>
          `;
          
          item.onclick = (e) => {
            e.preventDefault();
            // ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å: ‡πÉ‡∏™‡πà‡∏Ñ‡πà‡∏≤‡∏•‡∏á‡πÉ‡∏ô‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏´‡∏•‡∏±‡∏Å
            document.getElementById('nationalId').value = student.id;
            document.getElementById('studentName').value = student.name;
            // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡πâ‡∏≠‡∏á/‡∏ä‡∏±‡πâ‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏™‡πà‡∏á‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡πá‡πÉ‡∏™‡πà‡πÑ‡∏î‡πâ (‡∏™‡∏°‡∏°‡∏ï‡∏¥ object student ‡∏°‡∏µ property room)
            if(student.room) document.getElementsByName('room')[0].value = student.room;

            searchModal.hide();
          };

          listDiv.appendChild(item);
        });

      }).withFailureHandler((err)=>{
         listDiv.innerHTML = '<div class="text-center text-danger mt-3">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠</div>';
      }).searchStudents(keyword);
    }

    function maskId(id) {
      if(!id || id.length < 5) return id;
      return id.substring(0, 3) + "-XXXX-" + id.substring(id.length - 4);
    }
  </script>
</body>
</html>
